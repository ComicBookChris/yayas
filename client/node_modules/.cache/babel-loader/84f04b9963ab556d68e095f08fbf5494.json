{"ast":null,"code":"var _jsxFileName = \"C:\\\\e_commerce_project\\\\yayas\\\\client\\\\src\\\\pages\\\\Shop.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { getProductsByCount, fetchProductsByFilter } from \"../functions/product\";\nimport { getCategories } from \"../functions/category\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport ProductCard from \"../components/cards/ProductCard\";\nimport { Menu, Slider, Checkbox } from \"antd\";\nimport { DollarOutlined, DownSquareOutlined, StarOutlined } from \"@ant-design/icons\";\nimport Star from \"../components/forms/Star\";\nconst {\n  SubMenu,\n  ItemGroup\n} = Menu;\n\nconst Shop = () => {\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [price, setPrice] = useState([0, 0]);\n  const [ok, setOk] = useState(false);\n  const [categories, setCategories] = useState([]);\n  const [categoryIds, setCategoryIds] = useState([]);\n  const [star, setStar] = useState(\"\");\n  let dispatch = useDispatch();\n  let {\n    search\n  } = useSelector(state => ({ ...state\n  }));\n  const {\n    text\n  } = search;\n  useEffect(() => {\n    loadAllProducts(); // fetch categories\n\n    getCategories().then(res => setCategories(res.data));\n  }, []);\n\n  const fetchProducts = arg => {\n    fetchProductsByFilter(arg).then(res => {\n      setProducts(res.data);\n    });\n  }; // 1. load products by default on page load\n\n\n  const loadAllProducts = () => {\n    getProductsByCount(12).then(p => {\n      setProducts(p.data);\n      setLoading(false);\n    });\n  }; // 2. load products on user search input\n\n\n  useEffect(() => {\n    const delayed = setTimeout(() => {\n      fetchProducts({\n        query: text\n      });\n    }, 300);\n    return () => clearTimeout(delayed);\n  }, [text]); // 3. load products based on price range\n\n  useEffect(() => {\n    console.log(\"ok to request\");\n    fetchProducts({\n      price\n    });\n  }, [ok]);\n\n  const handleSlider = value => {\n    dispatch({\n      type: \"SEARCH_QUERY\",\n      payload: {\n        text: \"\"\n      }\n    }); // reset\n\n    setCategoryIds([]);\n    setPrice(value);\n    setStar(\"\");\n    setTimeout(() => {\n      setOk(!ok);\n    }, 300);\n  }; // 4. load products based on category\n  // show categories in a list of checkbox\n\n\n  const showCategories = () => categories.map(c => /*#__PURE__*/React.createElement(\"div\", {\n    key: c._id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Checkbox, {\n    onChange: handleCheck,\n    className: \"pb-2 pl-4 pr-4\",\n    value: c._id,\n    name: \"category\",\n    checked: categoryIds.includes(c._id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, c.name), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }\n  }))); // handle check for categories\n\n\n  const handleCheck = e => {\n    // reset\n    dispatch({\n      type: \"SEARCH_QUERY\",\n      payload: {\n        text: \"\"\n      }\n    });\n    setPrice([0, 0]);\n    setStar(\"\"); // console.log(e.target.value);\n\n    let inTheState = [...categoryIds];\n    let justChecked = e.target.value;\n    let foundInTheState = inTheState.indexOf(justChecked); // index or -1\n    // indexOf method ?? if not found returns -1 else return index [1,2,3,4,5]\n\n    if (foundInTheState === -1) {\n      inTheState.push(justChecked);\n    } else {\n      // if found pull out one item from index\n      inTheState.splice(foundInTheState, 1);\n    }\n\n    setCategoryIds(inTheState); // console.log(inTheState);\n\n    fetchProducts({\n      category: inTheState\n    });\n  }; // 5. show products by star rating\n\n\n  const handleStarClick = num => {\n    // console.log(num);\n    dispatch({\n      type: \"SEARCH_QUERY\",\n      payload: {\n        text: \"\"\n      }\n    });\n    setPrice([0, 0]);\n    setCategoryIds([]);\n    setStar(num);\n    fetchProducts({\n      stars: num\n    });\n  };\n\n  const showStars = () => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pr-4 pl-4 pb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Star, {\n    starClick: handleStarClick,\n    numberOfStars: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Star, {\n    starClick: handleStarClick,\n    numberOfStars: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Star, {\n    starClick: handleStarClick,\n    numberOfStars: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Star, {\n    starClick: handleStarClick,\n    numberOfStars: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Star, {\n    starClick: handleStarClick,\n    numberOfStars: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 7\n    }\n  }));\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-3 pt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  }, \"Search/Filter\"), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Menu, {\n    defaultOpenKeys: [\"1\", \"2\", \"3\"],\n    mode: \"inline\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(SubMenu, {\n    key: \"1\",\n    title: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"h6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(DollarOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 19\n      }\n    }), \" Price\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Slider, {\n    className: \"ml-4 mr-4\",\n    tipFormatter: v => `$${v}`,\n    range: true,\n    value: price,\n    onChange: handleSlider,\n    max: \"4999\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(SubMenu, {\n    key: \"2\",\n    title: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"h6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(DownSquareOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 19\n      }\n    }), \" Categories\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: \"-10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 15\n    }\n  }, showCategories())), /*#__PURE__*/React.createElement(SubMenu, {\n    key: \"3\",\n    title: /*#__PURE__*/React.createElement(\"span\", {\n      className: \"h6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(StarOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 19\n      }\n    }), \" Rating\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      marginTop: \"-10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 15\n    }\n  }, showStars())))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-9 pt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 9\n    }\n  }, loading ? /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"text-danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }, \"Loading...\") : /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"text-danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 13\n    }\n  }, \"Products\"), products.length < 1 && /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 35\n    }\n  }, \"No products found\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row pb-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 11\n    }\n  }, products.map(p => /*#__PURE__*/React.createElement(\"div\", {\n    key: p._id,\n    className: \"col-md-4 mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ProductCard, {\n    product: p,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 17\n    }\n  })))))));\n};\n\nexport default Shop;","map":{"version":3,"sources":["C:/e_commerce_project/yayas/client/src/pages/Shop.js"],"names":["React","useState","useEffect","getProductsByCount","fetchProductsByFilter","getCategories","useSelector","useDispatch","ProductCard","Menu","Slider","Checkbox","DollarOutlined","DownSquareOutlined","StarOutlined","Star","SubMenu","ItemGroup","Shop","products","setProducts","loading","setLoading","price","setPrice","ok","setOk","categories","setCategories","categoryIds","setCategoryIds","star","setStar","dispatch","search","state","text","loadAllProducts","then","res","data","fetchProducts","arg","p","delayed","setTimeout","query","clearTimeout","console","log","handleSlider","value","type","payload","showCategories","map","c","_id","handleCheck","includes","name","e","inTheState","justChecked","target","foundInTheState","indexOf","push","splice","category","handleStarClick","num","stars","showStars","v","marginTop","length"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  getProductsByCount,\r\n  fetchProductsByFilter,\r\n} from \"../functions/product\";\r\nimport { getCategories } from \"../functions/category\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport ProductCard from \"../components/cards/ProductCard\";\r\nimport { Menu, Slider, Checkbox } from \"antd\";\r\nimport {\r\n  DollarOutlined,\r\n  DownSquareOutlined,\r\n  StarOutlined,\r\n} from \"@ant-design/icons\";\r\nimport Star from \"../components/forms/Star\";\r\n\r\nconst { SubMenu, ItemGroup } = Menu;\r\n\r\nconst Shop = () => {\r\n  const [products, setProducts] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [price, setPrice] = useState([0, 0]);\r\n  const [ok, setOk] = useState(false);\r\n  const [categories, setCategories] = useState([]);\r\n  const [categoryIds, setCategoryIds] = useState([]);\r\n  const [star, setStar] = useState(\"\");\r\n\r\n  let dispatch = useDispatch();\r\n  let { search } = useSelector((state) => ({ ...state }));\r\n  const { text } = search;\r\n\r\n  useEffect(() => {\r\n    loadAllProducts();\r\n    // fetch categories\r\n    getCategories().then((res) => setCategories(res.data));\r\n  }, []);\r\n\r\n  const fetchProducts = (arg) => {\r\n    fetchProductsByFilter(arg).then((res) => {\r\n      setProducts(res.data);\r\n    });\r\n  };\r\n\r\n  // 1. load products by default on page load\r\n  const loadAllProducts = () => {\r\n    getProductsByCount(12).then((p) => {\r\n      setProducts(p.data);\r\n      setLoading(false);\r\n    });\r\n  };\r\n\r\n  // 2. load products on user search input\r\n  useEffect(() => {\r\n    const delayed = setTimeout(() => {\r\n      fetchProducts({ query: text });\r\n    }, 300);\r\n    return () => clearTimeout(delayed);\r\n  }, [text]);\r\n\r\n  // 3. load products based on price range\r\n  useEffect(() => {\r\n    console.log(\"ok to request\");\r\n    fetchProducts({ price });\r\n  }, [ok]);\r\n\r\n  const handleSlider = (value) => {\r\n    dispatch({\r\n      type: \"SEARCH_QUERY\",\r\n      payload: { text: \"\" },\r\n    });\r\n\r\n    // reset\r\n    setCategoryIds([]);\r\n    setPrice(value);\r\n    setStar(\"\");\r\n    setTimeout(() => {\r\n      setOk(!ok);\r\n    }, 300);\r\n  };\r\n\r\n  // 4. load products based on category\r\n  // show categories in a list of checkbox\r\n  const showCategories = () =>\r\n    categories.map((c) => (\r\n      <div key={c._id}>\r\n        <Checkbox\r\n          onChange={handleCheck}\r\n          className=\"pb-2 pl-4 pr-4\"\r\n          value={c._id}\r\n          name=\"category\"\r\n          checked={categoryIds.includes(c._id)}\r\n        >\r\n          {c.name}\r\n        </Checkbox>\r\n        <br />\r\n      </div>\r\n    ));\r\n\r\n  // handle check for categories\r\n  const handleCheck = (e) => {\r\n    // reset\r\n    dispatch({\r\n      type: \"SEARCH_QUERY\",\r\n      payload: { text: \"\" },\r\n    });\r\n    setPrice([0, 0]);\r\n    setStar(\"\");\r\n    // console.log(e.target.value);\r\n    let inTheState = [...categoryIds];\r\n    let justChecked = e.target.value;\r\n    let foundInTheState = inTheState.indexOf(justChecked); // index or -1\r\n\r\n    // indexOf method ?? if not found returns -1 else return index [1,2,3,4,5]\r\n    if (foundInTheState === -1) {\r\n      inTheState.push(justChecked);\r\n    } else {\r\n      // if found pull out one item from index\r\n      inTheState.splice(foundInTheState, 1);\r\n    }\r\n\r\n    setCategoryIds(inTheState);\r\n    // console.log(inTheState);\r\n    fetchProducts({ category: inTheState });\r\n  };\r\n\r\n  // 5. show products by star rating\r\n  const handleStarClick = (num) => {\r\n    // console.log(num);\r\n    dispatch({\r\n      type: \"SEARCH_QUERY\",\r\n      payload: { text: \"\" },\r\n    });\r\n    setPrice([0, 0]);\r\n    setCategoryIds([]);\r\n    setStar(num);\r\n    fetchProducts({ stars: num });\r\n  };\r\n\r\n  const showStars = () => (\r\n    <div className=\"pr-4 pl-4 pb-2\">\r\n      <Star starClick={handleStarClick} numberOfStars={5} />\r\n      <Star starClick={handleStarClick} numberOfStars={4} />\r\n      <Star starClick={handleStarClick} numberOfStars={3} />\r\n      <Star starClick={handleStarClick} numberOfStars={2} />\r\n      <Star starClick={handleStarClick} numberOfStars={1} />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"container-fluid\">\r\n      <div className=\"row\">\r\n        <div className=\"col-md-3 pt-2\">\r\n          <h4>Search/Filter</h4>\r\n          <hr />\r\n\r\n          <Menu defaultOpenKeys={[\"1\", \"2\", \"3\"]} mode=\"inline\">\r\n            {/* price */}\r\n            <SubMenu\r\n              key=\"1\"\r\n              title={\r\n                <span className=\"h6\">\r\n                  <DollarOutlined /> Price\r\n                </span>\r\n              }\r\n            >\r\n              <div>\r\n                <Slider\r\n                  className=\"ml-4 mr-4\"\r\n                  tipFormatter={(v) => `$${v}`}\r\n                  range\r\n                  value={price}\r\n                  onChange={handleSlider}\r\n                  max=\"4999\"\r\n                />\r\n              </div>\r\n            </SubMenu>\r\n\r\n            {/* category */}\r\n            <SubMenu\r\n              key=\"2\"\r\n              title={\r\n                <span className=\"h6\">\r\n                  <DownSquareOutlined /> Categories\r\n                </span>\r\n              }\r\n            >\r\n              <div style={{ marginTop: \"-10px\" }}>{showCategories()}</div>\r\n            </SubMenu>\r\n\r\n            {/* stars */}\r\n            <SubMenu\r\n              key=\"3\"\r\n              title={\r\n                <span className=\"h6\">\r\n                  <StarOutlined /> Rating\r\n                </span>\r\n              }\r\n            >\r\n              <div style={{ marginTop: \"-10px\" }}>{showStars()}</div>\r\n            </SubMenu>\r\n          </Menu>\r\n        </div>\r\n\r\n        <div className=\"col-md-9 pt-2\">\r\n          {loading ? (\r\n            <h4 className=\"text-danger\">Loading...</h4>\r\n          ) : (\r\n            <h4 className=\"text-danger\">Products</h4>\r\n          )}\r\n\r\n          {products.length < 1 && <p>No products found</p>}\r\n\r\n          <div className=\"row pb-5\">\r\n            {products.map((p) => (\r\n              <div key={p._id} className=\"col-md-4 mt-3\">\r\n                <ProductCard product={p} />\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Shop;"]},"metadata":{},"sourceType":"module"}