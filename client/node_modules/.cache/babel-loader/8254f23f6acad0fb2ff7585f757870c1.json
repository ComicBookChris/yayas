{"ast":null,"code":"var _jsxFileName = \"C:\\\\e_commerce_project\\\\yayas\\\\client\\\\src\\\\pages\\\\auth\\\\RegisterComplete.js\";\nimport React, { useState, useEffect } from 'react';\nimport { auth } from '..//../firebase';\nimport { toast } from 'react-toastify';\nimport { useDispatch } from 'react-redux';\nimport { createOrUpdateUser } from '../../functions/auth';\n\nconst RegisterComplete = ({\n  history\n}) => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  let dispatch = useDispatch();\n  /**useEffect will populate the email, within \r\n   * the const state about. \r\n   * 1st argument is an arrow function\r\n   * and 2nd argument is dependencies.\r\n   * This is known as a dependency array.\r\n   * At the moment it is empty by default.\r\n   *  As an example, [password] was inside \r\n   * brackets, when it changes,\r\n   * the function will run.\r\n    */\n\n  useEffect(() => {\n    setEmail(window.localStorage.getItem('emailForRegistration')); // console.log(window.location.href);\n    // console.log(window.localStorage.getItem(\"emailForRegistration\"));\n  }, [history]);\n\n  const handleSubmit = async e => {\n    e.preventDefault(); // validation\n\n    if (!email || !password) {\n      toast.error('Email and password is required');\n      return;\n    }\n\n    if (password.length > 6) {\n      toast.error('Password must be at least 6 characters long');\n      return;\n    }\n\n    try {\n      /**signInWithEmailLink needs two arguments, email, because\r\n       * which email? and the 2nd argument is the entire url.\r\n       * To get this use window.location.href\r\n       */\n      const result = await auth.signInWithEmailLink(email, window.location.href); // console.log('RESULT', result)\n\n      if (result.user.emailVerified) {\n        //remove user email from the local storage\n        window.localStorage.removeItem('emailForRegistration'); //get user id token\n\n        let user = auth.currentUser;\n        await user.updatePassword(password);\n        const idTokenResult = await user.getIdTokenResult(); //redux store\n\n        console.log('user', user, 'idTokenResult', idTokenResult);\n        createOrUpdateUser(idTokenResult.token).then(res => {\n          dispatch({\n            type: \"LOGGED_IN_USER\",\n            payload: {\n              name: res.data.name,\n              email: res.data.email,\n              token: idTokenResult.token,\n              role: res.data.role,\n              _id: res.data._id\n            }\n          });\n        }).catch(err => console.log(err)); //redirect\n\n        history.push('/');\n      }\n    } catch (error) {\n      console.log(error);\n      toast.error(error.message);\n    }\n  };\n\n  const completeRegistrationForm = () => /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    className: \"form-control\",\n    value: email,\n    disabled: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"password\",\n    className: \"form-control\",\n    value: password,\n    onChange: e => setPassword(e.target.value),\n    placeholder: \"Password must contain no less then six characters\",\n    autoFocus: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    className: \"btn btn-raised\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 13\n    }\n  }, \"Complete Registration\"));\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container p-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-md-6 offset-md-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 21\n    }\n  }, \"Register Complete\"), completeRegistrationForm())));\n};\n\nexport default RegisterComplete;","map":{"version":3,"sources":["C:/e_commerce_project/yayas/client/src/pages/auth/RegisterComplete.js"],"names":["React","useState","useEffect","auth","toast","useDispatch","createOrUpdateUser","RegisterComplete","history","email","setEmail","password","setPassword","dispatch","window","localStorage","getItem","handleSubmit","e","preventDefault","error","length","result","signInWithEmailLink","location","href","user","emailVerified","removeItem","currentUser","updatePassword","idTokenResult","getIdTokenResult","console","log","token","then","res","type","payload","name","data","role","_id","catch","err","push","message","completeRegistrationForm","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { auth } from '..//../firebase';\r\nimport { toast } from 'react-toastify';\r\nimport { useDispatch } from 'react-redux';\r\nimport { createOrUpdateUser } from '../../functions/auth';\r\n\r\nconst RegisterComplete = ({ history }) => {\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n\r\n    let dispatch = useDispatch();\r\n\r\n    /**useEffect will populate the email, within \r\n     * the const state about. \r\n     * 1st argument is an arrow function\r\n     * and 2nd argument is dependencies.\r\n     * This is known as a dependency array.\r\n     * At the moment it is empty by default.\r\n     *  As an example, [password] was inside \r\n     * brackets, when it changes,\r\n     * the function will run.\r\n      */\r\n    useEffect(() => {\r\n        setEmail(window.localStorage.getItem('emailForRegistration'));\r\n        // console.log(window.location.href);\r\n        // console.log(window.localStorage.getItem(\"emailForRegistration\"));\r\n    }, [history]);\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        // validation\r\n        if (!email || !password) {\r\n            toast.error('Email and password is required');\r\n            return;\r\n        }\r\n        if (password.length > 6) {\r\n            toast.error('Password must be at least 6 characters long');\r\n            return;\r\n        }\r\n        try {\r\n            /**signInWithEmailLink needs two arguments, email, because\r\n             * which email? and the 2nd argument is the entire url.\r\n             * To get this use window.location.href\r\n             */\r\n            const result = await auth.signInWithEmailLink(\r\n                email,\r\n                window.location.href\r\n            );\r\n            // console.log('RESULT', result)\r\n            if (result.user.emailVerified) {\r\n                //remove user email from the local storage\r\n                window.localStorage.removeItem('emailForRegistration');\r\n                //get user id token\r\n                let user = auth.currentUser\r\n                await user.updatePassword(password);\r\n                const idTokenResult = await user.getIdTokenResult()\r\n                //redux store\r\n                console.log('user', user, 'idTokenResult', idTokenResult);\r\n\r\n                createOrUpdateUser(idTokenResult.token)\r\n                    .then(\r\n                        res => {\r\n                            dispatch({\r\n                                type: \"LOGGED_IN_USER\",\r\n                                payload: {\r\n                                    name: res.data.name,\r\n                                    email: res.data.email,\r\n                                    token: idTokenResult.token,\r\n                                    role: res.data.role,\r\n                                    _id: res.data._id,\r\n                                },\r\n                            });\r\n                        })\r\n                    .catch((err) => console.log(err));\r\n\r\n                //redirect\r\n                history.push('/')\r\n            }\r\n        } catch (error) {\r\n            console.log(error);\r\n            toast.error(error.message);\r\n        }\r\n    };\r\n\r\n    const completeRegistrationForm = () =>\r\n        <form onSubmit={handleSubmit}>\r\n            <input\r\n                type=\"email\"\r\n                className=\"form-control\"\r\n                value={email}\r\n                disabled\r\n            />\r\n\r\n            <input\r\n                type=\"password\"\r\n                className=\"form-control\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                placeholder=\"Password must contain no less then six characters\"\r\n                autoFocus\r\n            />\r\n            <br />\r\n            <button type=\"submit\" className=\"btn btn-raised\">\r\n                Complete Registration\r\n        </button>\r\n        </form>\r\n\r\n    return (\r\n        <div className=\"container p-5\">\r\n            <div className=\"row\">\r\n                <div className=\"col-md-6 offset-md-3\">\r\n                    <h4>Register Complete</h4>\r\n                    {completeRegistrationForm()}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default RegisterComplete;"]},"metadata":{},"sourceType":"module"}